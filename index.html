<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Salad Generator</title>
  </head>
  <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script src="ingredients.fr.js"></script>
    <button id="moar">+</button><br> 
    <button id="premix">Prémix</button>
    <input type="checkbox" id="needbase">Base ?</input><br>
    <button id="lucky">I'm feeling lucky... kinda...</button><br>
    <script>
			var current = 0;
			var type = "salad"
			var lang = "fr"
			var categories = eval("cat_"+ type);
			var catnames = eval("cat_" + type + "_" + lang);
			function choose_element(i){
				var elems = eval($("#selector"+i).val())
				var index=Math.floor(Math.random()*elems.length)
				$("#result"+i).empty();
				$("#result"+i).append(elems[index]);
			}
			
			function create_selector(){
				$("body").append("<select name='selector" + current + "' id='selector" + current +"'></select>");
				$("body").append("<span id='result" + current + "'></span>");
				$("body").append("<button name='change" + current + "' id='change"+current + "'>Aut'chose!</button>");
				$("body").append("<br>");
				$("#selector"+current).append("<option></option>");		
				for (key in catnames){
					$("#selector"+current).append("<option value='"+key+"'>" + catnames[key] +"</option>");
				}
				$("#selector"+current).change(function(event){
					choose_element(event.target.id.replace("selector", ""));
				});
				$("#change"+current).click(function(event){
					choose_element(event.target.id.replace("change", ""));
				});
				current++;
			}
      $(document).ready(function(){
				for (var i = 0; i< 5; i++) {
					create_selector();
				}
				$("#moar").click(create_selector);
				$("#premix").click(premix);
				$("#lucky").click(lucky);  
      }); 
      function premix(){
				$("#selector0").val("veggies");
				$("#selector1").val("veggies");
				$("#selector2").val("proteins");
				$("#selector3").val("cheese");
				$("#selector4").val("extra");
				if($("#needbase").attr('checked')){
					if(current <= 5){
						create_selector();
					}
					$("#selector5").val("base");
				}
				fill_all();
			}
			function fill_all(){
				for (var i = 0; i<current; i++){
					choose_element(i);
				}
			}
			function lucky(){
				
				for (var i = 0; i<current; i++){
					var cat= categories[Math.floor(Math.random()*categories.length)];
					$("#selector"+i).val(cat);
				}
				fill_all()
			}
    </script>
  </body>
</html>
